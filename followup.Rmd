---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Left to do: dti3t asdd pns(?) openneuro rtmswm 


```{r}
library(tidyverse)
library(readxl)
library(foreign) #for reading in the spss files
```


```{r}
ds_pheno_pass <- read.csv("/scratch/gherman/SCZ_PINT/data/20181118_pheno_qapass.csv", stringsAsFactors = FALSE) %>% mutate_all(trimws) %>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ") 

qa_list <- ds_pheno_pass %>% select(., dataset,sub_id=subject_id.x, sex = Sex, dx = DX, age = Age)
```

Read in the participant data for all studies. These data have been filtered to only contain participants in erin's pheno_qapass document from November 2018. 

Add a mutate studyname to this later.

```{r}
ZHH <- read.csv('/projects/gherman/SZ_PINT/cleaner_data_sets/ZHH_arranged2.csv', stringsAsFactors = FALSE)%>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ") %>% mutate(.,sub_id=GRID)%>% mutate(., dataset="ZHH")


SPINS <- read.csv('/projects/gherman/SZ_PINT/cleaner_data_sets/SPINS_arranged2.csv', stringsAsFactors = FALSE)%>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ")  %>%  mutate(.,sub_id=str_replace_all(record_id,c("_"="","SPN01"=""))) %>% mutate(., dataset="SPINS")


PNS <- read.csv('/projects/gherman/SZ_PINT/cleaner_data_sets/PNS_arranged2.csv', stringsAsFactors = FALSE)%>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ") %>% mutate(.,sub_id=str_replace_all(record_id,c("_"="","PNS"="")))%>% mutate(., dataset="PNSC")


ds30 <- read.csv('/projects/gherman/SZ_PINT/cleaner_data_sets/ds00030_arranged2.csv', stringsAsFactors = FALSE)%>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ") %>% mutate(.,sub_id=str_remove(participant_id, "sub-")) %>% mutate(., dataset="ds000030_R1.0.5")


COBRE <- read.csv('/projects/gherman/SZ_PINT/cleaner_data_sets/COBRE_arranged2.csv', stringsAsFactors = FALSE)%>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ") %>% mutate(.,sub_id=subjectid) %>% mutate(., dataset="COBRE")


dti3t <- read.csv('/projects/gherman/SZ_PINT/cleaner_data_sets/dti3t_arranged2.csv', stringsAsFactors = FALSE)%>% mutate_all(na_if,"NA") %>% mutate_all(na_if, "") %>% mutate_all(na_if, " ") %>% mutate(.,sub_id=paste0("CMH",dti_id))%>% mutate(., dataset="DTI3T")

```

*SANS*, BPRS, WTAR, WASI, PANSS



bprs scores are very confusing. I'll get back to these. 

```{r}

#select(ZHH, )

```

SANS global scores (i will sum the global scores i think)

```{r}
ZHH_sans <- ZHH %>% select(sub_id, dataset, SANS_DATE, G_AffFlat, G_Alogia, G_Avolition, G_AsocAnh) %>% mutate(., G_total = select(., G_AffFlat, G_Alogia, G_Avolition, G_AsocAnh) %>% apply(1, sum))

SPINS_sans <- SPINS %>% select(., sub_id, dataset, sans_doa, sans7_global_flattening, sans12_global_alogia,sans17_global_avolition,sans22_global_asocial_anhedonia) %>% mutate(., G_total =select(.,sans7_global_flattening, sans12_global_alogia,sans17_global_avolition,sans22_global_asocial_anhedonia)%>% apply(1, sum))

PNS_sans <- PNS %>% select(., sub_id, dataset, sans_doa, sans7_global_flattening, sans12_global_alogia,sans17_global_avolition,sans22_global_asocial_anhedonia) %>% mutate(., G_total = select(.,sans7_global_flattening, sans12_global_alogia,sans17_global_avolition,sans22_global_asocial_anhedonia)%>% apply(1, sum))

ds30_sans <- ds30 %>% select(., sub_id, dataset, sans_g_flattening=sans7, sans_g_alogia=sans11, sans_g_avolition=sans16, sans_g_anhedonia = sans21) %>% mutate(., G_total = select(.,sans_g_flattening, sans_g_alogia, sans_g_avolition, sans_g_anhedonia)%>% apply(1, sum))


dti3t_sans <- dti3t %>% select(., sub_id, dataset, sans7_global_flattening, sans12_global_alogia, sans17_global_avolition, sans22_global_asocial_anhedonia) %>% mutate(., sans_G_total = select(.,sans7_global_flattening, sans12_global_alogia,sans17_global_avolition,sans22_global_asocial_anhedonia)%>% apply(1, sum))
```


```{r}
sans <- rbind(select(ZHH_sans, sub_id,dataset, G_total), select(SPINS_sans, sub_id, dataset,G_total), select(PNS_sans, sub_id,dataset, G_total), select(ds30_sans, sub_id, dataset,G_total), select(dti3t_sans, sub_id, dataset, G_total))

```


WTAR Scores

```{r}
SPINS_wtar <- SPINS %>% select(., sub_id, dataset,wtar_doa, wtar_raw = wtar_raw_score, wtar_std =  wtar_std_score,wtar_english_first)

COBRE_wtar <- COBRE %>% select(., sub_id, dataset,wtar_raw=CNP_05, wtar_std = CNP_06) #need to standardize these scores (and maybe compare to predicted scores as in here ->> https://link.springer.com/referenceworkentry/10.1007%2F978-0-387-79948-3_1500) (wtar_standard cnp_06 is all blank :( )) #predicted score is CNP_07, difference is CNP_08
dti3t_wtar <- dti3t %>% select(., sub_id, dataset,wtar_raw, wtar_std=wtar_standard) 

PNS_wtar <- PNS %>% select(., sub_id, dataset,wtar_doa, wtar_raw = wtar_raw_score, wtar_std =  wtar_std_score_calc )

wtar <- rbind(select(SPINS_wtar, sub_id,dataset,wtar_raw,wtar_std), select(COBRE_wtar, sub_id, dataset,wtar_raw,wtar_std), select(dti3t_wtar, sub_id,dataset, wtar_raw,wtar_std),select(PNS_wtar, sub_id, dataset,wtar_raw,wtar_std) )

```


PANSS Scores (according to this http://huibee.com/wordpress/wp-content/uploads/2013/11/PANSS-Scoring-Criteria.pdf)

```{r}
COBRE_panss <- COBRE %>% select(., sub_id,dataset, starts_with("FIPAN")) %>% mutate_at(vars(-sub_id,-FIPAN_30, -dataset),funs(recode(.,"Absent"=1,"Minimal"=2, "Mild"=3, "Moderate"=4,"Moderate severe"=5, "Severe"=6,"Extreme"=7))) %>%  select(c(paste0("FIPAN_",1:30)),everything()) %>% mutate(., panss_total_calc=rowSums(select(.,FIPAN_1:FIPAN_30))                                                            ,panss_positive_total_calc=rowSums(select(.,FIPAN_1:FIPAN_7)),panss_negative_total_calc=rowSums(select(.,FIPAN_8:FIPAN_14)),panss_general_total_calc=rowSums(select(.,FIPAN_15:FIPAN_30)))

dti3t_panss <- dti3t %>% select(., sub_id, dataset, starts_with("panss"))


panss <- rbind(select(COBRE_panss, sub_id, dataset, panss_total_calc,panss_positive_total_calc,panss_negative_total_calc, panss_general_total_calc), select(dti3t_panss, sub_id, dataset, panss_total_calc,panss_positive_total_calc,panss_negative_total_calc, panss_general_total_calc))
```

```{r}
compiled <- merge(qa_list,panss, by=c("sub_id","dataset"),all.x=TRUE,all.y=TRUE) %>% merge(.,sans, by=c("sub_id","dataset"),all.x=TRUE,all.y=TRUE)  %>% merge(.,wtar, by=c("sub_id","dataset"),all.x=TRUE,all.y=TRUE)
```


Other stuff to consider adding: 
Education (all)
Age of onset (all except openneuro)
Conners CPT 2(2)
Category fluency? (2)
MATRICS (2... maybe more? have to try interpreting better)
HVLT (2? 3?)
BACS symbol coding (2)

I think their mighyt be WAIS or WASI for more than one study. If there's a FSIQ estimate can we combine it from multiple tests?


Look into whether ASDD has anything.